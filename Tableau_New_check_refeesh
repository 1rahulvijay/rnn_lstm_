import tableauserverclient as TSC

# Tableau Server details
server_url = 'https://your-tableau-server.com'
username = 'your-username'
password = 'your-password'
site_id = 'your-site-id'  # use '' if you are not using any site

# Data source ID
datasource_id = 'your-datasource-id'

# Sign in to Tableau Server
tableau_auth = TSC.TableauAuth(username, password, site_id)
server = TSC.Server(server_url, use_server_version=True)

with server.auth.sign_in(tableau_auth):
    try:
        # Get the specific data source by ID
        datasource = server.datasources.get_by_id(datasource_id)
        
        if datasource:
            # Get all schedules
            all_schedules, pagination_item = server.schedules.get()
            
            # Find refresh tasks related to the specific data source
            datasource_refresh_tasks = []
            for schedule in all_schedules:
                if schedule.target.id == datasource_id and schedule.target.type == 'DataSource':
                    datasource_refresh_tasks.append(schedule)

            if datasource_refresh_tasks:
                # Get the latest extract refresh task
                latest_task = max(datasource_refresh_tasks, key=lambda task: task.updated_at)
                print(f"Latest refresh date for datasource '{datasource.name}': {latest_task.updated_at}")
            else:
                print(f"No extract refresh tasks found for datasource '{datasource_id}'")
        else:
            print(f"Datasource with ID '{datasource_id}' not found")
    except Exception as e:
        print(f"An error occurred: {e}")
