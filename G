import smtplib
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
from email.mime.image import MIMEImage
from email.mime.base import MIMEBase
from email import encoders
from jinja2 import Environment, FileSystemLoader

# Email configuration
SMTP_SERVER = 'smtp.example.com'
SMTP_PORT = 587
SMTP_USERNAME = 'your_email@example.com'
SMTP_PASSWORD = 'your_password'
FROM_EMAIL = 'your_email@example.com'
TO_EMAIL = 'recipient_email@example.com'
SUBJECT = 'LCR Mail Template'

# Jinja2 environment setup
env = Environment(loader=FileSystemLoader('.'))
template = env.get_template('email_template.html')

# Email content
email_content = template.render(
    report_name='Monthly Financial Report',
    date='July 29, 2024',
    purpose='To provide financial overview',
    report_details='Details of the financial report',
    source_system='Internal Financial System',
    request_and_owner='John Doe',
    contact_person='Jane Smith'
)

# Create email message
msg = MIMEMultipart()
msg['From'] = FROM_EMAIL
msg['To'] = TO_EMAIL
msg['Subject'] = SUBJECT

msg.attach(MIMEText(email_content, 'html'))

# Attach logo image
with open('path_to_logo_image.png', 'rb') as img_file:
    img = MIMEImage(img_file.read())
    img.add_header('Content-ID', '<logo_image>')
    img.add_header('Content-Disposition', 'inline', filename='logo_image.png')
    msg.attach(img)

# Send email
try:
    with smtplib.SMTP(SMTP_SERVER, SMTP_PORT) as server:
        server.starttls()
        server.login(SMTP_USERNAME, SMTP_PASSWORD)
        server.sendmail(FROM_EMAIL, TO_EMAIL, msg.as_string())
    print('Email sent successfully')
except Exception as e:
    print(f'Failed to send email: {e}')
